<!DOCTYPE html>
<html>

<head profile="http://www.w3.org/2005/10/profile"> 
<link rel="icon" type="image/png" href="http://example.com/myicon.png">

<meta charset="utf-8" />
<!-- 
viewport(반응형 웹) :  여러 디스플레이 통해 접속 가능 
width=device-width : 페이지 너비를 기기의 스크린 너비로 설정
initial-scale=1 : 페이지 로딩 시 원래 크기를 사용 (확대, 축소 되지 않음)
-->
<!--for messagebox-->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D.I.Y</title>
<!-- Blockly 개발자모드 코드 안보이게 막음-->
<!-- <script type="text/javascript">
console = {};
console.log = function(){};
console.warn = function(){};
console.error = function(){};
console.info = function(){}; 
</script>  -->

<!-- #####################################################################################################  -->
<!-- ******************************               CDN                       ******************************* -->
<!-- #####################################################################################################  -->
<!-- jquery --> 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<!-- bootstrap -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

<!-- tensorflow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"> </script>

<!-- blockly-->
<script src="/js/blockly/storage.js"></script>
<script src="/js/blockly/brython.js"></script>
<script src="/js/blockly/brython_stdlib.js"></script>
<script src="https://unpkg.com/prop-types@15.6/prop-types.js"></script>

<!-- plotly -->
<script src="https://cdn.plot.ly/plotly-latest.min.js" charset="utf-8"></script>    

<!--numjs-->             
<script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>  

<!-- pyodide cdn변경 20.11.16 -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/pyodide/v0.15.0/full/pyodide.js"></script> -->

<!-- <script src="http://inhatc.iptime.org:4519/pyodide.js"></script>  -->

<!-- 기태 처리 (파일) 21.01.06------------------------------------------------------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/BrowserFS/2.0.0/browserfs.min.js"></script>

<!--   javascript 언어 규칙 및 블록 변환과 관련된 내용을 압축한 파일 -->
<script src="/js/blockly/blockly_compressed.js"></script>
<script src="/js/blockly/javascript_compressed.js"></script>
<script src="/js/blockly/python_compressed.js"></script>
<script src="/js/blockly/blocks_compressed.js"></script>

<!--미리 정의되어 있는 기본 블록에 대한 설정을 모두 담고 있음.-->
<script src="/js/blockly/block_pyodide.js"></script>

<!-- codemirror 추가 -->
<script src="/js/codemirror/lib/codemirror.js"></script>
<link rel="stylesheet" href="/js/codemirror/lib/codemirror.css">
<script src="/js/codemirror/mode/javascript/javascript.js"></script>
<script src="/js/codemirror/mode/python/python.js"></script>
<!-- codemirror 추가 -->

<!-- codemirror 스타일 지정 -->
<link rel="stylesheet" href="./js/codemirror/theme/oceanic-next.css">
<!-- codemirror 스타일 지정 -->

<!-- cdoemirror 자동 완성 기능 -->
<script src="./js/codemirror/addon/hint/show-hint.js"></script>
<script src="./js/codemirror/addon/hint/javascript-hint.js"></script>
<script src="./js/codemirror/addon/hint/anyword-hint.js"></script>
<link rel="stylesheet" href="./js/codemirror/addon/hint/show-hint.css">
<!-- cdoemirror 자동 완성 기능 -->

<!-- 그림판자리 canvas -->
<!-- <script src="/js/utils/canvas.js"></script> -->

<!-- 블록, 블록+코드, 코드 변경-->
<script src="/js/utils/tabDisplay.js"></script>

<!-- 그래프 aside -->
<script src="/js/utils/aside.js"></script>

<!-- 쿠키 -->
<script src="/js/utils/cookie.js"></script>

<!-- 크롤링 -->
<script src=/js/croll.js></script>

<!--messageBox-->
<script src="./js/blockly/messagebox/messagebox.js"></script>
<link href="./js/blockly/messagebox/messagebox.css" rel="stylesheet" type="text/css">

<script>setCookie("download_block","", 1);</script>

<!-- #####################################################################################################  -->
<!-- ******************************              블록 import                ******************************* -->
<!-- #####################################################################################################  -->
<script src=/js/script.js></script>


<!-- #####################################################################################################  -->
<!-- ******************************                CSS                      ******************************* -->
<!-- #####################################################################################################  -->

<!-- 사이드 바 -->
<link rel="stylesheet" href="/css/sidebar.css">

<!-- table --> 
<link rel="stylesheet" href="/css/table_custom.css">

<!-- 기본 css -->
<link rel="stylesheet" href="/css/basic.css">
<link rel="stylesheet" href="/css/libraryDiv.css">

<!-- 테마 변경-->
<script src="/js/utils/themeChange.js"></script>


<!-- 명성이형 파일 불러올때 필요한 변수설정 
<script>
var Data_process_on = 0;
var DL_Gra = 0;
var testing_1 = 0;
</script>
명성이형 파일 불러올때 필요한 변수설정 -->
<!-- 하단 변수가 없는 경우 맷플롯립에서 문제가 발생함 삭제 및 주석 금지 -->
<script>var DL_Gra = 0; var flagMatplotlibImport = 0;</script>
<!-- plotly 데이터 시각화를 위해 필요-->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="./js/utils/plotly.js"></script>
<!-- plotly -->

</head>

<body id="bg" class="bg-light">
<!-- 언어 패키지, 카테고리 색상 -->
<!-- 2020-12-05 양승국 동적 변경을 위해 head -> body로 옮김-->
<script id="lan" src="/js/blockly/msg/js/ko.js"></script> 

<!-- 라이브러리 추가를 위한 modal -->
<div class="libraryDiv">
<div class="header" style="width:96%">
	<img src="Library_Title.png" style="margin: 5px;">
	<hr style="border: solid 1px white;
width: 72%;
display: inline-block;
margin-bottom: -5px;">
	<img id="modal_close_btn" class="large close icon" src="close.png">
</div>
<!-- 카드 -->
<div class="libraryGrid">
	<!-- 컬럼 -->
	<div class="column">
	<!-- 카드 상세 -->
	<div class="ui fluid">
		<div class="libraryimage">
		<img src="data_science.png">
		</div>
		<div class="content">
		<a class="header">데이터 사이언스</a>
		<div class="description">
			데이터 분석을 위한 Pandas, 시각화를 위한 Matplotlib, 수치 계산을 위한 Numpy가 포함된 라이브러리입니다.
		</div>
		</div>
		<div id="ds_import_btn" data-id="1" class="importBtn">
		추가
		</div>
	</div>
	</div>
	<!-- 컬럼 -->
	<div class="column">
	<!-- 카드 상세 -->
	<div class="ui fluid">
		<div class="libraryimage">
		<img src="scikit-learn.png">
		</div>
		<div class="content">
		<a class="header">머신러닝</a>
		<div class="description">
			데이터 전처리와 머신러닝 모델을 만들 수 있는 Scikit-Learn가 포함된 라이브러리입니다.<br>
		</div>
		</div>
		<div id="ml_import_btn" data-id="2" class="importBtn">추가</div>
	</div>
	</div>

	<!-- 컬럼 -->
	<div class="column">
	<!-- 카드 상세 -->
	<div class="ui fluid">
		<div class="libraryimage">
		<img src="scikit-image.png">
		</div>
		<div class="content">
		<a class="header">이미지 프로세싱</a>
		<div class="description">
			다양한 이미지를 처리할 수 있는 Scikit-Image가 포함된 라이브러리입니다.<br>
		</div>
		</div>
		<div id="image_processing_import_btn" data-id="3" class="importBtn">
		추가
		</div>
	</div>
	</div>
</div>
</div>

<!-- 기타 설정 모달 -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog">
	<div class="modal-content">
	<div class="modal-header">
		<h5 class="modal-title" id="exampleModalLabel">기타 설정</h5>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		
		<!-- 테마 변경 버튼-->
		<button id="" class="btn btn-outline-success btn-sm" onclick="themeChange()">테마변경</button>

		<!-- 파일 올리기 (지원)-->
		<input id="button_file_upload" type="button" class="btn btn-outline-secondary btn-sm " value="파일 업로드" onclick="localFileOpen3()"/>

		<!-- 폰트 크기 변환 -->
		<select id="fontsize">
		<option id = "none" value="none" selected>Font Size</option>
		<option id = "15" value="15">15</option>
		<option id = "20" value="20">20</option>
		<option id = "25" value="25">25</option>
		<option id = "30" value="30">30</option>
		</select>

	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
	</div>
	</div>
</div>
</div>

<!-- 그래프 사이드바 start -->
<aside id="sidebar">
<!-- 그래프 사이드바 닫기 버튼 -->
<div class="sidebar">
	<button id="runButton2" class="btn btn-outline-success btn-sm mr-1" onclick="runButton();"
	style="display:none;">실행</button>

	<!-- 실행 로딩 중 -->
	<div id="loading_image2" style="display: inline-block;">
	<object type="image/svg+xml" data="Rolling-2s-30px.svg"></object>
	</div>

	<button id="button_close" class="btn btn-outline-primary btn-sm mr-1" onclick="sidebar_toggle();">닫기</button>
	<button id="button_clear" class="btn btn-outline-danger btn-sm" onclick="csv_clear();">지우기</button>
	<button id="button_reset" class="btn btn-outline-danger btn-sm" onclick="sidebar_clear();">전체 초기화</button>
</div>

<div id=graph></div>

<div id=graph1 style="height:500px; width:900px;"><img id="pyplotfigure"/></div>
<div id="csv_show"></div>
</aside>
<!-- 그래프 사이드바 end -->

<div class="container-fluid">
<!-- nav -->
<nav id="nav" class="navbar navbar-expand-lg bg-light">

	<!-- logo -->
	<a class="navbar-brand" href="#"><img src="logo2-2.png"/></a>

	<!-- 왼쪽 구역 start-->
	<div class="d-flex flex-wrap text-white" style="width:80%;">

	<!-- 파일 열기 -->
	<div class="input-group col-md-2 ml-3 mt-2 btn-sm custom-file">
		<input type="file" id="file" class="custom-file-input" accept="text/xml"
		onchange="loadBlock(); this.value=null;return false;">
		<label class="custom-file-label mr-1" for="file">파일열기</label>
	</div>

	<!-- 블록 지우기 -->
	<input id="button_block_del" type="button" class="btn btn-outline-secondary btn-sm mr-0" onClick="demoWorkspace.clear();"
		value="블록 지우기" />

	<!-- 블록 저장 -->
	<input id="button_block_save" type="button" class="btn btn-outline-secondary btn-sm " value="블록 저장" onclick="saveBlock()"/>

	<!-- 블록 탭 -->
	<div class="btn-group" role="group">
		<button type="button" class="btn btn-secondary mr-0" onclick="visibleBlock()">블럭</button>
		<button type="button" class="btn btn-secondary mr-0" onclick="visibleAll()">블럭+코드</button>
		<button type="button" class="btn btn-secondary mr-0" onclick="visibleCode()">코드</button>
	</div>

	</div>
	<!-- 왼쪽 구역 end -->

	<!-- 오른쪽 구역 start -->
	<div class="d-flex flex-wrap text-white" style="width: 55%;">

	<!-- 2020-12-05 양승국 언어변경을 위해 생성-->
	<!--언어변환 -->
	<!--
		21.03.26 지원 주석처리
		<select id="language" class="form-control col-md-2 mt-2 ml-1">
		<option id = "ko" value="kor">Ko</option>
		<option id = "en" value="eng">en</option>
		</select>
	-->
	
	<!-- 실행 버튼 -->
	<input id="runButton1" type="button" class="btn btn-outline-success btn-sm mr-1" style="display:none;"
		onClick="runButton()" value="실행" /> <!-- 다시 원상 복귀 style="display:none;" [on click 전] -->
	
		<!-- 실행 로딩 중 -->
	<div id="loading_image1"><object type="image/svg+xml" data="Rolling-2s-30px.svg"></object></div>
	
	<!-- 결과 버튼 -->
	<input id="button_console_clear" type="button" class="btn btn-outline-secondary btn-sm mr-1" onClick=clear_result();
		value="결과 지우기" />

	<!-- 저장 버튼 -->
	<input id="button_code_save" type="button" class="btn btn-outline-secondary btn-sm mr-1" onClick=file_save();
		value="코드저장" />

	<!-- 라이브러리 추가 (우진) -->
	<input id="sidebar_add_libs" type="button" class="btn btn-outline-warning btn-sm" value="라이브러리 추가"/>
	
	<!-- 그래프 버튼 -->
	<input id="sidebar_button" type="button" class="btn btn-outline-primary btn-sm" value="그래프"
		onclick="sidebar_toggle()" />

	<!-- 기타 버튼 -->
	<button type="button" class="btn btn-info" data-toggle="modal" data-target="#exampleModal">
		기타
	</button>
	</div>
	<!-- 오른쪽 구역 end -->
</nav>
<!-- nav end -->

<!-- 하단 내용 -->
<div class="row" style="height: 90vh;">

	<!-- 블럭 나오는 부분(왼쪽) -->
	<div id="blocklyDiv" class="col-md-8" style="height: 90vh;"></div>

	<!-- 오른쪽 -->
	<div id="codeDiv" class="col-md-4">
	<div id="codeDiv1">
		<div class="card shadow-sm">
		<div class="text-white bg-dark">
			<h6 id="code" class="my-1 mx-1">코드
			<input type="checkbox" checked id="toggle-two"/>
		</h6>
		<!-- 테마 변경-->
		<script src="/js/utils/blockCode.js"></script>
		<script>
			var global_var = true;
			$(function() {
			$('#toggle-two').bootstrapToggle({
				off: '블록코드OFF',
				on: '블록코드ON',
				size: 'small',
				onstyle:'primary',
				offstyle:'default',
				height: 5,
				width: 135
			});
			})
			$(document).ready(function(){
				separate_editor();
			$("#toggle-two").change(function(){
				separate_editor();
				global_var = false;
			});
			
		});
		console.log('toggle: ' + $('#toggle-two').prop('checked'));
		</script>
		</div>
		<div style="position:relative; " style="height: 80vh;">
			<div id="pyCodeEditor"></div>
			<div id="jsCodeEditor" style="display: none"></div>
			<div id="asyncCodeEditor"></div>
		</div>
		</div>
	</div>
	<!-- console -->
	<div id="codeDiv2">
		<div class="card mb-6 mt-6 shadow-sm">
		<div id="console" class="text-white bg-dark">
			<h5 class="my-1 mx-1">콘솔</h5>
		</div>
		<textarea id="exeArea" class="form-control bg-light" readonly style="height: 18vh"></textarea>
		</div>
	</div>
	</div> <!-- 오른쪽 -->
</div> <!-- 하단 -->

<!-- camera-->
<!--
<video id="gum-local" autoplay playsinline></video>
<button id="showVideo">Open camera</button>
-->
</div> 
<!-- container end -->

<!-- code mirror -->
<script src="/js/utils/codeMirror.js"></script>
<script src="/js/utils/basicFunction.js"></script>
<script src="/js/utils/blockFunction.js"></script>

<script>
// (demoWorkspace = 블록배치하는 공간) 블록이 나타나는 부분
var demoWorkspace = Blockly.inject( 
	"blocklyDiv", {
	toolbox: toolbox, // 툴박스  보이기 
	grid: // 그리드 보이기 
	{
		spacing: 0,
		length: 3,
		colour: '#ccc',
		snap: true
	},
	zoom: // 줌 기능 3단계 변경
	{
		controls: true,
		wheel: true,
		startScale: 1.0,
		maxScale: 3,
		minScale: 0.3,
		scaleSpeed: 1.2,
		//pinch: true
	},
	trashcan: true, // 휴지통
	/*theme: {
		'blockStyles': {
		"list_blocks": {
			"colourPrimary": "#4a148c",
			"colourSecondary": "#AD7BE9",
			"colourTertiary": "#CDB6E9"
		}
		},
		'categoryStyles': {
		"list_category": {
			"colour": "#4a148c"
		}
		},
		'componentStyles': {
		'toolboxBackgroundColour': '#848484', // toolbox background
		'toolboxForegroundColour': '#fff',
		'flyoutBackgroundColour': '#D8D8D8', // toolbox color
		}
	}*/
	renderer: "zelos" // 제로스 테마
	}
);

demoWorkspace.addChangeListener(codeUpdate);  // 코드 갱신하기 메소드
demoWorkspace.addChangeListener(whenSelected);// 선택 되었을 때 메소드
</script>

<script>
function runcode_2(code, code2){
	console.log(code); // 파이썬코드찍는부분
	console.log("-----");
	console.log(code2); // 자바스크립트코드 찍는부분
	let exe = document.getElementById('exeArea'); // 콘솔 창 ID가져옴
	languagePluginLoader.then(() => {
		try {
			exe.innerHTML = pyodide.runPython(code);
			let stdout = pyodide.runPython("sys.stdout.getvalue()"); // 결과값을 싹 받아줌
			exe.innerHTML = stdout;
		} catch (e) {
			exe.innerHTML = e;  
		}
	});
};
</script>

<script>
//==================================
// 블록을 실행했을 때 
//==================================
//새로운 실행방법
function runButton() {
	
	// 그래프 위쪽 삭제
	$("#graph1").remove();
	$("#csv_show").before("<div id='graph1' style=\"height:500px; width:900;\"><img id='pyplotfigure' /></div>");
	// 그래프 위쪽 삭제

	// 그래프같은 이미지들을 싹다 잡아옴 plt.show()하면 바로 되는이유
	globalThis.iodide = {
	output: {
		element: (tagName) => {
		let outputPane = document.createElement(tagName);
		document.querySelector("#graph1").appendChild(outputPane);
		console.log(outputPane)
		return outputPane;
		}
	}
	};

	Blockly.Python.addReservedWords('code');      // // 이 언어의 예약어 목록에 하나 이상의 단어를 추가한다.
	var code = pyEditor.getValue();               // py 코드미러의 값을 code로 저장
	Blockly.JavaScript.addReservedWords('code2'); // // 이 언어의 예약어 목록에 하나 이상의 단어를 추가한다.
	var code2 = jsEditor.getValue();              // js 코드미러의 값을 code2로 저장
	
	Blockly.Python.addReservedWords('code_async');
	var code_async = asyncEditor.getValue();
	// 이 부분이 코드 싹다 잡아와서 출력
	// 실행했을때 그래프를 지우고 하기 위해
	// plt.cla - 클리어
	// plt.clf - figure클리어
	// os는 data폴더 mount 에러 임시로 해결하기 위해
	languagePluginLoader.then(() => {
		pyodide.runPython(`
			import sys
			import os 
			import io
			import matplotlib.pyplot as plt
			plt.cla()
			plt.clf()
			sys.stdout = io.StringIO()
		`);
	});


	// 코드상 에러 구현
	if(code){
		if (code.indexOf("os.chdir") != -1){
			let current_path = pyodide.runPython(`os.getcwd()`); // 현재 경로 받아옴
			let dir_list = pyodide.runPython(`os.listdir()`); // 디렉토리 비교하기 위해
			let root_list = pyodide.runPython(`os.listdir('/')`);

			let start_index = code.indexOf("os.chdir("); 
			let end_index = code.indexOf(")", start_index);

			let replace_str = code.substr(start_index, (end_index - (start_index - 1)))

			// 1. start_index부터 앞쪽으로 검색하여 개행이 어디 있는 지 확인하고, 몇번째 문자인지 변수에 저장
			let err_index = (start_index + 10) - (code.lastIndexOf("\n", start_index + 10) - 1);
			
			// 2. start_index부터 앞쪽으로 검색하여 개행이 몇개인지 파악하고, 몇번째 라인인지 확인
			let err_str = code.substr(0, start_index + 10);
			let err_line = err_str.match(/\n/g);
			if(err_line === null) 
				err_line = 1;
			else
				err_line = err_str.match(/\n/g).length + 1;
			
			let err_dir = code.substr(start_index + 10, ((end_index-2) - (start_index + 10 - 1)))

			let output_err = "Error: Traceback (most recent call last):"
			let output_err2 = "File \"/lib/python3.8/site-packages/pyodide/_base.py\", line 70, in eval_code"
			let output_err3 = "eval(compile(mod, \"<exec>\", mode=\"exec\"), ns, ns)"
			let output_err4 = "File \"<exec>\", line " + String(err_line) +", in <module>"
			let output_err5 = "FileNotFoundError: [Errno 2] No such file or directory: "
			
			if (current_path.indexOf("/data") != -1){ // data 하위 디렉토리 모두 적용
				
				let dir_index;
				let bool_;

				for(dir_index = 0; dir_index < dir_list.length; dir_index++){
					if(dir_list[dir_index] == err_dir || err_dir.indexOf('/') != -1 || err_dir.indexOf('../') != -1){
						bool_ = false;
						break;
					} else if(err_dir == '..' || err_dir == '.'){
						bool_ = false;
						break;
					} else
						bool_ = true;
				}

				if (dir_list.length == 0 && !(err_dir.indexOf('/') != -1 || err_dir.indexOf('../') != -1 || err_dir == '..' || err_dir == '.'))
				bool_ = true; // 디렉토리 내부가 비어 있을 때도 적용
				
				if(bool_ == true){
					code = code.replace(code, '');
					//code = code.replace(replace_str, '"' + output_err + '"');
					code = "print('" + output_err + "')";
					code = code + ("\nprint(' " + output_err2 + "')");
					code = code + ("\nprint('  " + output_err3 + "')");
					code = code + ("\nprint(' " + output_err4 + "')");
					code = code + ('\nprint("' + output_err5 + "'" + err_dir + "'" + '")');
					console.log('data폴더');
				};
			};
		};

		// 크롤링 req.text부분 처리
		if (code.indexOf("req.text") != -1){
			code = code.replace("req.text", 'req');
		};
	};

	// 순차적 실행을 위해 놓은 코드 async, .then()
	async function runcode() {
		if($('#toggle-two').prop('checked')){
			runcode_2(code, code2);
		} else {
			runcode_2(code_async, code2);
		}
	}
	// runcode끝낸 뒤, 테이블 형식 블록을위해 이걸 넣어줌
	runcode().then(() => {
		if(eval(code2) == undefined){
			document.getElementById('exeArea').innerHTML+='\n';
		} else {
			console.log("error : javascript code error");
		}
	});
};
// runbutton end
	
function Check_matplotlib_user_input(a, b) {
	if (a == 1 && b == 1) {
		DL_Gra = "graph_both_1";
	} else if (a == 1 || b == 1) {
		DL_Gra = "graph_or_1";
	} else {
		DL_Gra = 0;
	}
}
</script>

<!-- csv를 테이블로 출력-->
<script src="/js/utils/csvTablePrint.js"></script>
<!-- 라이브러리 임포트 기능 테스트 -->
<script src="/js/utils/libraryAdd.js"></script>
<!-- prompt 설정 -->
<script src="/js/utils/prompt.js"></script>
<!-- 로컬 파일 오픈하기 -->
<script src="/js/utils/localFileOpen.js"></script>
<!-- 로컬로 파일 다운로드-->
<script src="/js/utils/fileDownload.js"></script>

<script>
//=====기태 처리 (파일) 21.01.06  : 파일 로딩에 대해 인터벌 적용 ================================
setTimeout(function() {
	BrowserFS.install(window);
	BrowserFS.configure({
		//fs: "LocalStorage"
		fs: "InMemory"      // 5MB 이상의 큰 파일 처리를 위해 변경(2021.03.03 - 기태)
	}, function(e) {
		fss = require('fs'); // [Node.JS] fs의 기능을 fss로 이동 => 브라우저 fs와 겹침방지
		
		var fs = BrowserFS.BFSRequire('fs'); // [BrowserFS] 사용하려면 기본적으로 필요한 건가봄?
		fss.writeFileSync(fileName2, ""); // temp라는 이름의 빈 파일 생성
		
		// [Pyodide] languagePluginLoader : pyodide초기화? 시작할때 무조건 필요 
		languagePluginLoader.then(async ()=>{   
			//  pyodide모듈 로드 우진
			pyodide.loadPackage(['biopython','beautifulsoup4','sympy'])
			.then(() => {
				console.log("모듈 로드 완료.");
			})
			
			let FS = pyodide._module.FS; // 모듈의 파일시스템
			let PATH = pyodide._module.PATH; // 모듈의 경로
			
			console.log(FS.mount);
			console.log(PATH);

			// Create an Emscripten interface for the BrowserFS
			var BFS = new BrowserFS.EmscriptenFS(FS, PATH);
			// Create mount point in Emscripten FS
			FS.createFolder(FS.root, 'data', true, true);
			// Mount BrowserFS into Emscripten FS
			FS.mount(BFS, {root: '/'}, '/data');

			
			// 이부분은 내부 콘솔(f12 X)에 찍어주기 위해 필요한 부분
			// requests class 임의로 만들어줌. 
			pythonCode = `              
				import sys
				from io import StringIO
				# 크롤링 하기위해 js로만든 _requestsURL 메소드 import
				from js import _requestsURL

				req = ""

				class requests:
					def get(htmlurl):
						_requestsURL(htmlurl)
						return req

				sys.stdout = StringIO()      
			`
			// 비동기 부분 다 끝나고 이거 되는거같음
			languagePluginLoader.then(() => {
				return pyodide.loadPackage(['micropip'])
			})
			.then(() => {
				pyodide.runPython(pythonCode);
				console.log('pyodide 라이브러리 로딩완료');
				$("#loading_image1").hide(); // 홈페이지 로딩 끝나면 로딩 이미지 없앰 
				$("#runButton1").css({
					'display': "block"
				});
				$("#loading_image2").hide(); // 그래프 로딩 끝나면 로딩 창 없앰 
				$("#runButton2").css({
					'display': "inline"
				});       
			});
		});
	});
}, 1000);  // js 파일 다운로드를 위해 인터벌 설정 
</script>   
<!-- 기태 처리 (파일) 끝 20.12.29 ------------------------------------------------------------------------->
</body> 
<!--camera
<script src="/js/blockly/cam.js"></script>
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
-->
</html>