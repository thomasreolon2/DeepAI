<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BlockJas</title>
  <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
  <script src="/js/blockly/storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
  <script src="/js/blockly/brython.js"></script>
  <script src="/js/blockly/brython_stdlib.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"> </script>
  <!--  Blockly 자체의 설정과 관련된 파일 -->
  <!--pyodide-->
  <script src="https://pyodide-cdn2.iodide.io/v0.15.0/full/pyodide.js"></script>

  <!--   javascript 언어 규칙 및 블록 변환과 관련된 내용을 압축한 파일 -->
  <script src="/js/blockly/blockly_compressed.js"></script>
  <script src="/js/blockly/javascript_compressed.js"></script>
  <script src="/js/blockly/python_compressed.js"></script>
  <script src="/js/blockly/blocks_compressed.js"></script>
  <!--미리 정의되어 있는 기본 블록에 대한 설정을 모두 담고 있음.-->
  <script src="/js/blockly/block_pyodide.js"></script>
  <!-- pyodide 블록 -->
  <script src="/js/blockly/block_pyodide_gen.js"></script>
  <script src="/js/blockly/block_pyodide_gen_javascript.js"></script>
  <!-- pyodide 블록 -->

  <!-- Pandas 블록 -->
  <script src="/js/blockly/block_pandas.js"></script>
  <script src="/js/blockly/block_pandas_gen.js"></script>
  <!-- Pandas 블록 -->

  <!-- <script src="/js/blockly/test.js"></script>
  <script src="/js/blockly/test_gen.js"></script>  -->


  <!-- numpy 블록 -->
  <script src="/js/blockly/python_gen.js"></script>
  <script src="/js/blockly/dataS_.js"></script>
  <!-- numpy 블록 -->

  <script src="/js/blockly/msg/js/ko.js"></script> <!-- 언어 패키지 -->
  <script src="/js/blockly/FileSaver.js"></script> <!-- 파일 저장 기능 -->
  <script src="/js/blockly/tau-prolog.js"></script> <!-- tau Prolog 추가 -->

  <!--plotly cdn-->
  <script src="https://cdn.plot.ly/plotly-latest.min.js" charset="utf-8"></script>

  <!--numjs-->
  <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>

  <!-- codemirror 추가 -->
  <script src="/js/codemirror/lib/codemirror.js"></script>
  <link rel="stylesheet" href="/js/codemirror/lib/codemirror.css">
  <script src="/js/codemirror/mode/javascript/javascript.js"></script>
  <script src="/js/codemirror/mode/python/python.js"></script>
  <!-- codemirror 추가 -->

  <!-- codemirror 스타일 지정 -->
  <link rel="stylesheet" href="./js/codemirror/theme/oceanic-next.css">
  <!-- codemirror 스타일 지정 -->

  <!-- cdoemirror 자동 완성 기능 -->
  <script src="./js/codemirror/addon/hint/show-hint.js"></script>
  <script src="./js/codemirror/addon/hint/javascript-hint.js"></script>
  <script src="./js/codemirror/addon/hint/anyword-hint.js"></script>
  <link rel="stylesheet" href="./js/codemirror/addon/hint/show-hint.css">
  <!-- cdoemirror 자동 완성 기능 -->

  <!--jquery-->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <!-- bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

  <!-- canvas -->
  <script src="./js/canvas.js"></script>

  <!--css-->
  <link rel="stylesheet" href="css\sidebar.css">

  <!-- plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="./js/utils/plotly.js"></script>
  <script>
    languagePluginLoader.then(() => {
      pyodide
        .loadPackage(['pandas', 'numpy','scikit-learn'])
        .then(() => {
          console.log('pandas,numpy 로딩완료')
        });
    });
  </script>
  <!-- table -->
  <link rel="stylesheet" href="/css/table_custom.css">
  <style type="text/css">
    canvas {
      background-color: white;
      border: 1px solid black
    }

    .btn {
      margin: 10px;
    }

    .file {
      margin: 10px;
    }

    .form-control {
      height: 50%;
    }

    div {
      /*overflow: hidden; 이거 끄니까 코드미러 넘버링나옴 */
      height: auto;
    }

    .canvas {
      margin-left: 10px;
    }

    #pyCodeEditor {
      position: absolute;
      width: 100%;
    }

    #jsCodeEditor {
      position: relative;
      visibility: hidden;
    }
  </style>

</head>

<!-- onload : body가 떳을때 작동되는 js입력 -->

<body onload="">

  <!--사이드바-->
  <div>
    <aside id="sidebar">
      <button class="btn  btn-sm"><span>그래프</span></button>
      <div id=graph></div>
      <!-- <div id=graph1 style="height: 300px;"></div>
      <div id=graph2 style="height: 300px;"></div>
      <div id=graph3 style="height: 300px;"></div>-->
      <div id="csv_show">
      </div>
    </aside>
  </div>
  <div class="container-fluid">

    <!-- nav -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #f4f6ff;">

      <!-- a -->
      <a class="navbar-brand pl-2" href="#"><img src="logo2-2.png" /></a>

      <!-- 왼쪽 구역-->
      <div class="d-flex flex-wrap text-white ml-3" style="width: 50%;">

        <!-- 파일 열기 -->
        <div class="input-group col-md-4 ml-3 mt-2 btn-sm custom-file">
          <input type="file" id="file" class="custom-file-input" accept="text/xml"
            onchange="loadBlock(); this.value=null;return false;">
          <label class="custom-file-label mr-1" for="file">파일열기</label>
        </div>

        <!-- 블록 지우기 -->
        <input id="button" type="button" class="btn btn-outline-secondary btn-sm mr-1" onClick="demoWorkspace.clear();"
          value="블록 지우기" />

        <!-- 블록 저장 -->
        <input id="button" type="button" class="btn btn-outline-secondary btn-sm" onClick="saveBlock();"
          value="블록 저장" />

        <!-- 블록 탭 -->
        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" class="btn btn-secondary mr-0" id="visibleBlock">블럭</button>
          <button type="button" class="btn btn-secondary mr-0" id="visibleAll">블럭+코드</button>
          <button type="button" class="btn btn-secondary mr-0" id="visibleCode">코드</button>
        </div>

        <!-- 탭들 display -->
        <script>
          // 블럭만 보이기
          $('#visibleBlock').click(function () {
            $('#codeDiv').css({
              'display': "none"
            });
            $('#blocklyDiv').css({
              'display': "block",
            });
            // svg width 100%
            $('.blocklySvg').attr('width', '100%');
            $('#blocklyDiv').attr('class', 'col-md-12');
            // Blockly 리사이즈
            Blockly.svgResize(demoWorkspace);
          });

          // 전부 보이기
          $('#visibleAll').click(function () {
            $('#blocklyDiv').css({
              'display': "block",
            });
            $('#codeDiv').css({
              'display': "block"
            });
            $('#blocklyDiv').attr('class', 'col-md-6');
            // Blockly 리사이즈
            Blockly.svgResize(demoWorkspace);
          });

          // 코드만 보이기
          $('#visibleCode').click(function () {
            $('#blocklyDiv').css({
              'display': "none"
            });
            $('#codeDiv').css({
              'display': "block"
            });
          })
        </script>
      </div>

      <!-- 오른쪽 구역 -->
      <div class="d-flex flex-wrap text-white" style="width: 50%;">

        <!-- display -->
        <select id="display_select" class="form-control col-md-4 mt-2 ml-3">
          <option value="python">python</option>
          <option value="javascript">javascript</option>
        </select>

        <!-- 실행 버튼 -->
        <input id="button" type="button" class="btn btn-outline-success btn-sm mr-1" onClick="runButton()" value="실행" />

        <!-- 결과 버튼 -->
        <input id="button" type="button" class="btn btn-outline-secondary btn-sm mr-1" onClick="clear_result();"
          value="결과 지우기" />

        <!-- 저장 버튼 -->
        <input id="button" type="button" class="btn btn-outline-secondary btn-sm mr-1" onClick="file_save();"
          value="코드저장" />

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="modal"
          data-target="#staticBackdrop">그림판</button>

        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1"
          aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">그림판</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body">
                <!-- canvas -->
                <canvas id="canvas" class="canvas" width="300" height="300"></canvas>

              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">취소</button>
                <!-- reset button -->
                <form>
                  <input type="button" id="reset" class="btn btn-danger mr-1" value="다시 그리기">
                </form>
                <a id="download" download="image.png"><button type="button" class="btn btn-primary"
                    onClick="canvas_save()">그림 저장</button></a>
                <input type="file" id="btn_upload" name="btn_upload" style="display: none;" />
              </div>
            </div>
          </div>
        </div> <!-- 모달 -->
      </div> <!-- 오른쪽 구역 -->
    </nav>

    <!-- 하단 내용 -->
    <div class="row" style="height: 90vh;">

      <!-- 블럭 나오는 부분(왼쪽) -->
      <div id="blocklyDiv" class="col-md-6" style="height: 90vh;"></div>


      <!-- 오른쪽 -->

      <div id="codeDiv" class="col">
        <div class="card shadow-sm">
          <div class="text-white bg-dark">
            <h5 class="my-1 mx-1">코드</h5>
          </div>
          <div style="position:relative; " style="height: 80vh;">
            <dive id="pyCodeEditor"></dive>
            <dive id="jsCodeEditor"></dive>
          </div>
        </div>

        <!-- console -->
        <div class="card mb-6 mt-6 shadow-sm">
          <div class="text-white bg-dark">
            <h5 class="my-1 mx-1">콘솔</h5>
          </div>
          </textarea>
          <textarea id="exeArea" class="form-control" readonly style="height: 10vh;"></textarea>
        </div>
      </div> <!-- 오른쪽 -->
    </div> <!-- 하단 -->
  </div> <!-- container -->

  <!-- Toolbox 정의 -->
  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" class="toolbox" style="display: none">
    <category name="논리 (Logic)" colour="%{BKY_LOGIC_HUE}">
      <!-- <block type="if_c"></block> -->
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="반복 (Repeat)" colour="%{BKY_LOOPS_HUE}">
      <!-- <block type="for_c"></block> -->
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="연산 (Operation)" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
      <block type="math_atan2">
        <value name="X">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="Y">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <!-- <block type="mexp"></block> -->
    </category>
    <category name="문자 (Text)" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <!-- <block type="textc"></block> -->
      <block type="text_print"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <!-- <block type="printc"></block> -->

    </category>
    <category name="배열 (Array)" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <!-- <block type="lists_sort"></block>
      <block type="tfarraylen"></block> -->

    </category>
    <!-- <category name="색상" colour=" %{BKY_COLOUR_HUE}">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category> -->

    <!-- 커스텀 블록 -->
    <sep></sep>
    <category name="변수 (Variable)" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="함수 (Function)" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE">
      <block type="printc"></block>
      <block type="nj_array"></block>
      <block type="forp"></block>
      <block type="sump"></block>

    </category>
    <sep></sep>


    <!--pyodide_test-->
    <category name="pyodide_test" colour="%{BKY_VARIABLES_HUE}">
      <block type="printc"></block>
      <block type="nj_array"></block>
      <block type="forp"></block>
      <block type="sump"></block>
      <block type="lrgraph"></block>
      <block type="logicgraph"></block>
      <block type="array_get"></block>
      <block type="csv2"></block>
      <!-- <block type="csv3"></block> -->
      <block type="scikit_learn"></block>
      <block type="csvdataframe_J">
        <value name="pd">
          <block type="variables_get">
            <field name="VAR">pd</field>
          </block>
        </value>
      </block>



    </category>

    <!--  numpy //  2020 - 09 - 04  -->
    <category name="데이터 사이언스" colour="%{BKY_LOOPS_HUE}">
      <category name="Numpy 기본 연산" colour="%{BKY_LOOPS_HUE}">
        <!-- <block type="variable"></block>  변수 생성  -->
        <!-- <block type="variable_name"></block> 다른 변수에 넣기   -->
        <block type="print"></block> <!-- 결과 print  -->
        <block type="create_arry"></block> <!-- 배열 생성  -->
        <block type="arry_mul"></block> <!-- 배열 곱 -->
        <block type="arry_div"></block> <!-- 배열 나누셈 -->
        <block type="arry_plus"></block> <!-- 배열 합 -->
        <block type="arry_minus"></block> <!-- 배열 빼기 -->
      </category>
      <!-- numpy 함수들 -->
      <category name="Numpy 함수" colour="%{BKY_LOOPS_HUE}">
        <block type="np_array"></block> <!-- numpy.arry  -->
        <block type="numpy_zeros"></block> <!-- zeros 0으로 채우기 -->
        <block type="numpy_full"></block> <!-- full 배열을 해당 숫자로 채우기  -->
        <block type="numpy_eye"></block> <!-- eye 배열을 대각선 1로 채우기   -->
        <block type="numpy_max"></block> <!-- max 최대값 찾기  -->
        <block type="numpy_min"></block> <!-- min 최소값 찾기  -->
        <block type="numpy_shape"></block> <!-- shape 행렬 차원 반환  -->
        <block type="numpy_reshape"></block> <!-- reshape 행렬 차원 변환  -->
        <block type="numpy_random_rand"></block> <!--  random. randn or randint 무작위 숫자 생성     -->
        <block type="numpy_exp"></block> <!--  exp 지수     -->
      </category>
    </category>
    <!-- 데이터 사이언스  -->

    <!-- 2020-09-07, Pandas Blocks -->
    <!-- 2020-09-05 양승국 수정-->
    <category name="Pandas" colour="%{BKY_LOGIC_HUE}">
      <block type="csv_library">
        <value name="pan_lib_var">
          <block type="variables_get">
            <field name="VAR">pd</field>
          </block>
        </value>
      </block>
      <block type="load_csv">
        <value name="pan_lod_var">
          <block type="variables_get">
            <field name="VAR">pd</field>
          </block>
        </value>
      </block>
      <block type="fill_null_data"></block>
      <block type="pyo_lib"></block>
      <block type="pandas_print"></block>
      <block type="normal"></block>
      <block type="select_row_delete"></block>
      <block type="select_column_delete"></block>
      <!-- <block type="save_image"></block> -->
      <block type="list"></block>
      <block type="header"></block>
      <block type="select_row_list"></block>
      <block type="select_column_list"></block>
      <block type="select_row_column_value"></block>
      <block type="row_count"></block>
      <block type="column_count"></block>
      <!-- 2020-09-06 양승국 -->
      <block type="pandas_datalist"></block>
      <block type="pandas_dataframe">
        <value name="lib">
          <block type="variables_get">
            <field name="VAR">pd</field>
          </block>
        </value>
      </block>
      <!-- <block type="image_list"></block> -->
    </category>

    <category name="Python Test">
      <!-- 새 블록  딕셔너리 -->
      <block type="dict">
        <value name="DICT">
        </value>
      </block>
      <!-- 집합 -->
      <block type="set">
        <value name="SET">
        </value>
      </block>
      <!-- 튜플 -->
      <block type="tuple">
        <value name="tuple">
        </value>
      </block>

      <!-- 집합선택 -->
      <block type="set_menu">
        <value name="set_menu">
        </value>
      </block>

      <!-- 딕셔너리 선택 -->
      <block type="dic_menu">
        <value name="dic_menu">
        </value>
      </block>
      <block type="for_python">
        <value name="for_python"></value>
      </block>
    </category>



  </xml>

  </xml>
  <!-- code mirror -->
  <script>
    var jsEditor = CodeMirror(document.getElementById("jsCodeEditor"), {
      mode: "javascript",
      //   value: "codemirror",
      theme: "oceanic-next",
      inputStyle: "contenteditable",
      // readOnly: true,
      lineNumbers: true,
      extraKeys: {
        "Ctrl-Space": "autocomplete"
      },
      //   spellcheck: true,   autocorrect: true,
    });

    var pyEditor = CodeMirror(document.getElementById("pyCodeEditor"), {
      mode: "python",
      //   value: "codemirror",
      theme: "oceanic-next",
      inputStyle: "contenteditable",
      // readOnly: true,
      lineNumbers: true,
      extraKeys: {
        "Ctrl-Space": "autocomplete"
      },
      //   spellcheck: true,   autocorrect: true,
    });
  </script>

  <script id="jsScript" type="application/javascript">
    // var codeArea = document.getElementById("textArea"); // 코드 나타나는 부분 
    var codeArea = jsEditor.getValue();

    var demoWorkspace = Blockly.inject( // 블록이 나타나는 부분 
      "blocklyDiv", {
      toolbox: document.getElementById("toolbox"), // 툴박스  보이기 
      grid: // 그리드 보이기 
      {
        spacing: 0,
        length: 3,
        colour: '#ccc',
        snap: true
      },
      zoom: // 줌 기능 
      {
        controls: true,
        wheel: true,
        startScale: 1.0,
        maxScale: 3,
        minScale: 0.3,
        scaleSpeed: 1.2
      },
      trashcan: true, // 휴지통
      /*theme: {
        'blockStyles': {
          "list_blocks": {
            "colourPrimary": "#4a148c",
            "colourSecondary": "#AD7BE9",
            "colourTertiary": "#CDB6E9"
          }
        },
        'categoryStyles': {
          "list_category": {
            "colour": "#4a148c"
          }
        },
        'componentStyles': {
          'toolboxBackgroundColour': '#848484', // toolbox background
          'toolboxForegroundColour': '#fff',
          'flyoutBackgroundColour': '#D8D8D8', // toolbox color
        }
      }*/
      renderer: "zelos"
    }

    );

    // 생성될 코드에 대해 선택하는 부분       
    var jsCode = Blockly.JavaScript.workspaceToCode(demoWorkspace); // 자바 스크립트 선택 
    var pyCode = Blockly.Python.workspaceToCode(demoWorkspace); // 파이썬 선택 

    var delCount = 0;
    var fileState = 0;
    var fileName = "";

    // ==================================
    // 블록 저장하기 
    //===================================  
    function saveBlock() {
      var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
      var p_xml = Blockly.Xml.domToPrettyText(xml);
      var fileObject = new File([p_xml], "blocks.xml");
      saveAs(fileObject);
    }

    // ==================================
    // 블록 불러오기 
    //===================================  
    function loadBlock() {
      var reader = new FileReader();
      var files = document.getElementById("file").files;
      var file = files[0];
      if (file) {
        reader.onload = function (e) {
          var xml = reader.result;
          var dom = Blockly.Xml.textToDom(xml);
          Blockly.Xml.appendDomToWorkspace(dom, demoWorkspace);
          fileName = file.name;

          try {
            var pyCode = Blockly.Python.workspaceToCode(demoWorkspace);
            pyEditor.setValue(pyCode);
          } catch (e) {
            console.log('python 코드가 매핑되어 있지 않습니다. Error : ' + e);
          }
          try {
            var jsCode = Blockly.JavaScript.workspaceToCode(demoWorkspace);
            jsEditor.getValue() = jsCode;

          } catch (e) {
            console.log('java script 코드가 매핑되어 있지 않습니다. Error : ' + e);
          }
        };
        reader.readAsText(file);
      }
    }

    // ==================================
    // 코드 갱신하기 
    //===================================  
    function codeUpdate(event) {
      async function coderun() {
        try {
          var pyCode = Blockly.Python.workspaceToCode(demoWorkspace);
          pyEditor.setValue(pyCode);
        } catch (e) {
          console.log('python 코드가 매핑되어 있지 않습니다. Error : ' + e);
        }
      } coderun().then(() => {
        try {
          var jsCode = Blockly.JavaScript.workspaceToCode(demoWorkspace);
          jsEditor.setValue(jsCode);
        } catch (e) {
          console.log('java script 코드가 매핑되어 있지 않습니다. Error : ' + e);
        }
      });


    }

    // ==================================
    // 결과 지우기 
    //===================================  
    function clear_result() {
      document.getElementById("exeArea").value = "";
    }

    // ==================================
    // 파일로 저장하기 
    //===================================  
    function file_save() {
      var code_java = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      var code_python = Blockly.Python.workspaceToCode(demoWorkspace);
      var blobObject = new Blob([code_python, code_java]);
      saveAs(blobObject, "download.js");
      //saveAs(blobObject, "download.py");
    }

    // ==================================
    // 블록을 선택했을 때 
    //=================================== 
    function whenSelected(event) {
      if (event.type == Blockly.Events.CREATE) {
        var block = demoWorkspace.getBlockById(event.blockId);
        console.log('블록이 선택됨1');
      }
      if (event.type == Blockly.Events.UI && event.element === "click") {
        var block = demoWorkspace.getBlockById(event.blockId);
        if ('csv2' == block.type) {
          openTextFile(event.blockId);
        }
      }
    }
    demoWorkspace.addChangeListener(codeUpdate);
    demoWorkspace.addChangeListener(whenSelected);
  </script>

  <!-- ==================================
  ====== 블록 실행
  ===================================-->
  <script>
    // 실행 버튼
    function runButton() {
      Blockly
        .Python
        .addReservedWords('code');
      var code = pyEditor.getValue();
      Blockly
        .JavaScript
        .addReservedWords('code2');
      var code2 = jsEditor.getValue();
      async function runcode() {
        languagePluginLoader.then(() => {
          try {
            pyodide.runPython(code);
          } catch (e) {
            document
              .getElementById('exeArea')
              .innerHTML = e;
          }
        });

      };
      runcode().then(() => {
        document
          .getElementById('exeArea')
          .innerHTML = eval(code2);
      });

    };


    function openTextFile(blockId) {
      var input = document.createElement("input");
      input.type = "file";
      input.accept = ".csv"; // 확장자가 xxx, yyy 일때, ".xxx, .yyy"
      input.onchange = function (e) {
        $("#tblshow").empty();
        $("#tblhead").empty();
        ///////////////////////////////////////////
        var fileArray = new Array(); // csv to json?
        if (e.target.files != undefined) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var csvval = e.target.result.split("\n");
            var csvvalue = csvval[0].split(",");
            var inputrad = "";
            // csv view! header 
            for (var i = 0; i < csvvalue.length; i++) {
              var header = csvvalue[i];
            }
            csvval[0] = csvval[0].replace('\r', '');
            // row
            var cnt = (csvval.length < 2000) ? csvval.length : 2000;
            for (var i = 1; i < cnt; i++) {
              csvval[i] = csvval[i].replace('\r', '');
              var cols = csvval[i].split(',');
              var fileObject = new Object();
              for (var j = 0; j < cols.length; j++) {
                var value = cols[j];
                var name = csvval[0].split(',')[j] // hedaer name
                fileObject[name] = value; // value
                // table body add
              }
              fileArray.push(fileObject);
            }
            create_table($("#csv_show")[0], JSON.stringify(fileArray));
            // // 파일 set
            var block = demoWorkspace.getBlockById(blockId);
            var bId = Blockly.mainWorkspace.getBlockById(blockId)
            block.setFieldValue(JSON.stringify(fileArray), 'csv_url'); // csv_url -> field_input ID
          };
          reader.readAsText(e.target.files.item(0));
        }
      };

      input.click();
    }

    function processFile(file) {
      var reader = new FileReader();
      reader.onload = function () {
        var fileResult = reader.result;
        var val = sessionStorage.setItem('file', fileResult);
      };
      reader.readAsText(file, /* optional */ "cp949");
    }

    /* 그래프 */
    const metrics = ['loss', 'val_loss', 'acc', 'val_acc']
    const container = {
      name: 'Model Training',
      styles: {
        height: '1000px'
      }
    };

    async function saveModel(model) {
      model.save('localstorage://my-model');
      alert('완료되었습니다.');
    }

    // canvas 활성화 & 비활성화
    /*function canvas_power() {
      var canvasState = $("#canvas")[0];
      var btnSave = $("#btn_save")[0];
      if (canvasState.style.display == "" || canvasState.style.display == "none") {
        canvasState.style.display = "block";
        $("#btn_save")[0].style.visibility = "visible";
        $("#btn_canvas").val("그림판 비활성화");
      } else {
        canvasState.style.display = "none";
        $("#btn_save")[0].style.visibility = "hidden";
        $("#btn_canvas").val("그림판 활성화");
      }
    }
    */

    // canvas 저장하기
    const alphaPixel = []

    function canvas_save() {
      var download = $("#download")[0];
      var canvas = $("#canvas")[0];
      var c = document.getElementById("canvas");
      var ctx = c.getContext("2d");
      console.log(ctx);
      var pixel = ctx.getImageData(0, 0, 28, 28).data;
      for (i = 3, idx = 0; i < pixel.length; i += 4) {
        alphaPixel[idx] = pixel[i];
        idx++;
      }
      console.log(alphaPixel);
    }

    /*
     * 코드미러 화면 전환(python&javascript)
     */
    $("#display_select").change(function () {
      var selectName = $(this).find(":selected").val();
      var pyEditor = $("#pyCodeEditor");
      var jsEditor = $("#jsCodeEditor");

      if (selectName == "javascript") {
        jsEditor.css("visibility", "visible");
        pyEditor.css("visibility", "hidden");
      } else if (selectName == "python") {
        pyEditor.css("visibility", "visible");
        jsEditor.css("visibility", "hidden");
      }
    });

    //사이드바
    $(function () {
      var duration = 300;

      var $side = $('#sidebar');
      var $sidebt = $side.find('button').on('click', function () {
        $side.toggleClass('open');

        if ($side.hasClass('open')) {
          $side.stop(true).animate({
            right: '0px'
          }, duration);
          $sidebt.find('span').text('X');
        } else {
          $side.stop(true).animate({
            right: '-900px'
          }, duration);
          $sidebt.find('span').text('그래프');
        };
      });
    });

    // TESTER = document.getElementById('graph1');
    // Plotly.newPlot(TESTER, [{
    //   x: [1, 2, 3, 4, 5],
    //   y: [1, 2, 4, 8, 16]
    // }], {
    //   margin: { t: 0 }
    // });
    // TESTER = document.getElementById('graph2');
    // Plotly.newPlot(TESTER, [{
    //   x: [1, 2, 3, 4, 5],
    //   y: [1, 2, 4, 8, 16]
    // }], {
    //   margin: { t: 0 }
    // });
    // TESTER = document.getElementById('graph3');
    // Plotly.newPlot(TESTER, [{
    //   x: [1, 2, 3, 4, 5],
    //   y: [1, 2, 4, 8, 16]
    // }], {
    //   margin: { t: 0 }
    // });

    // 테마변경  
    /*unction changeTheme() {
      var theme = document.getElementById('themeChanger');

      if (theme.value === "dark") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.Dark);
      } else if (theme.value === "high_contrast") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.HighContrast);
      } else if (theme.value === "deuteranopia") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.Deuteranopia);
      } else if (theme.value === "tritanopia") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.Tritanopia);
      } else if (theme.value === "modern") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.Modern);
      } else if (theme.value === "zelos") {
        Blockly.getMainWorkspace().setTheme(Blockly.Themes.Zelos);
      } else {
        var testTheme = getTestTheme(theme.value);
        if (testTheme) {
          Blockly.getMainWorkspace().setTheme(testTheme);
        } else {
          Blockly.getMainWorkspace().setTheme(Blockly.Themes.Classic);
        }
      }
    }
    */
    // 화면에 찍기 프린트
    function printc(x) {
      var savetext = $('#exeArea').val();
      $('#exeArea').val(savetext + x + '\n');
    }

    // 선형회귀 그래프
    function LRgraph(x, y, w, b) {
      var ba = new Array();
      for (var i = 0; i < x.length; i++) {
        console.log("w : " + w);
        console.log(x[i] * w + b);
        ba.push(x[i] * w + b);
      }
      console.log("ba : " + ba);


      var data = {
        x: x,
        y: y,
        mode: 'markers',
        type: 'scatter'
      };

      var prediction = {
        x: x,
        y: ba,
        mode: 'lines',
        type: 'scatter'
      };
      var layout = {
        autosize: true

      };
      var layout = {
        autosize: true
      };

      var datax = [data, prediction];

      Plotly.newPlot('graph', datax, layout);
    }
    // 로지스틱 그래프
    function Logisticgraph(x, y, w, b) {
      var ba=new Array();
      function sigmoida(ax) {
        value = 1 / (1 + (Math.exp(-ax)));
        return value;
      }
      for (var i = 0; i < x.length; i++) {

        pred = sigmoida((x[i] * w + b));
        ba.push(pred);
      }
      console.log(ba);
      var data = {
        x: x,
        y: y,
        mode: 'markers',
        type: 'scatter',
        name: 'data'
      };

      var prediction = {
        x: x,
        y: ba,
        mode: 'lines',
        type: 'scatter',
        name: 'prediction'
      };
      var layout = {
        autosize: true

      };
      var layout = {
        autosize: true
      };

      var datax = [data, prediction];

      Plotly.newPlot('graph', datax, layout);
    }
  </script>
  <!-- <script src="/js/utils/canvas.js"></script> 그림판 -->
</body>

</html>